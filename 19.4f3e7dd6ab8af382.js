"use strict";(self.webpackChunkarchery_stats=self.webpackChunkarchery_stats||[]).push([[19],{3019:(M,m,i)=>{i.r(m),i.d(m,{ActiveSessionPageComponent:()=>F});var d=i(6895),u=i(4850),_=i(9132),C=i(7579),f=i(2722),v=i(8206),S=i(7418),a=i(6858),x=i(1282),A=i(4781),E=i(5528),l=i(848),y=i(5621),g=i(6276),t=i(4650);const P=["scorePerShotChartRef"],Z=["averagePerEntryChartRef"],R=["shotDistributionChartRef"];a.kL.register(a.ST,a.uw,a.f$,a.od,a.jn,x.Z,a.Gu,a.u,A.Z);let b=(()=>{class s{set session(e){this._session=e,this.scorePerShotChart&&this.setChartOptions()}get session(){return this._session}ngAfterViewInit(){a.kL.defaults.color=y.I.foregroundText(),a.kL.defaults.borderColor=y.I.getProp("--foreground-divider"),this.scorePerShotChart=new a.kL(this.scorePerShotChartRef.nativeElement,{type:"line",data:{datasets:[]}}),this.averagePerEntryChart=new a.kL(this.averagePerEntryChartRef.nativeElement,{type:"line",data:{datasets:[]}}),this.shotDistributionChart=new a.kL(this.shotDistributionChartRef.nativeElement,{type:"line",data:{datasets:[]}}),this.setChartOptions()}setChartOptions(){const e=this.session.entries.map(p=>p.shots.map(c=>c.value)).flat(),n=this.session.entries.map(p=>(0,g.Iz)(p.shots.map(c=>c.value))),o=(0,g.Y8)(e),h=(0,g.Y8)(n);this.scorePerShotChart.data={labels:this.session.entries.map((p,c)=>c+1),datasets:[{...l.EC,data:this.session.entries.map(p=>(0,g.Iz)(p.shots.map(c=>c.value)))}]},this.scorePerShotChart.options={...(0,l.lR)(10*this.session.numberOfArrows,h)},this.scorePerShotChart.update("none"),this.averagePerEntryChart.data={labels:this.session.entries.map((p,c)=>c+1),datasets:[{...l.EC,data:this.session.entries.map(p=>+(0,g.Y8)(p.shots.map(c=>c.value)).toFixed(2))}]},this.averagePerEntryChart.options={...(0,l.lR)(12,o)},this.averagePerEntryChart.update("none"),this.shotDistributionChart.data={labels:new Array(11).fill(0).map((p,c)=>c),datasets:[{...l.EC,data:(0,E.iA)(this.session.entries).asArray}]},this.shotDistributionChart.options={...(0,l.lR)(void 0,null),scales:{y:{ticks:{precision:0}}}},this.shotDistributionChart.update("none")}}return s.\u0275fac=function(e){return new(e||s)},s.\u0275cmp=t.Xpm({type:s,selectors:[["app-session-chart-stats"]],viewQuery:function(e,n){if(1&e&&(t.Gf(P,5),t.Gf(Z,5),t.Gf(R,5)),2&e){let o;t.iGM(o=t.CRH())&&(n.scorePerShotChartRef=o.first),t.iGM(o=t.CRH())&&(n.averagePerEntryChartRef=o.first),t.iGM(o=t.CRH())&&(n.shotDistributionChartRef=o.first)}},inputs:{session:"session"},standalone:!0,features:[t.jDz],decls:15,vars:1,consts:[[1,"chart-holder"],["scorePerShotChartRef",""],["averagePerEntryChartRef",""],["shotDistributionChartRef",""]],template:function(e,n){1&e&&(t.TgZ(0,"h2"),t._uU(1),t.qZA(),t.TgZ(2,"div",0),t._UZ(3,"canvas",null,1),t.qZA(),t.TgZ(5,"h2"),t._uU(6,"Average per entry"),t.qZA(),t.TgZ(7,"div",0),t._UZ(8,"canvas",null,2),t.qZA(),t.TgZ(10,"h2"),t._uU(11,"Shot distribution"),t.qZA(),t.TgZ(12,"div",0),t._UZ(13,"canvas",null,3),t.qZA()),2&e&&(t.xp6(1),t.hij("Score per ",n.session.numberOfArrows," shots"))},changeDetection:0}),s})();var T=i(84),I=i(5270),D=i(7697),w=i(7009),O=i(6235);function U(s,r){if(1&s){const e=t.EpF();t.TgZ(0,"app-score-input",9),t.NdJ("savedEntry",function(o){t.CHM(e);const h=t.oxw(2);return t.KtG(h.archerySessionRepo.addEntryForActiveSession(o))}),t.qZA()}if(2&s){const e=t.oxw().ngIf;t.Q6J("numberOfArrows",e.numberOfArrows)}}function Q(s,r){if(1&s){const e=t.EpF();t.TgZ(0,"app-entries-table",12),t.NdJ("entryEdited",function(o){t.CHM(e);const h=t.oxw(4);return t.KtG(h.onEntryEdit(o))})("deleteEntry",function(o){t.CHM(e);const h=t.oxw(4);return t.KtG(h.onDeleteEntry(o))}),t.qZA()}if(2&s){const e=t.oxw(3).ngIf,n=t.oxw();t.Q6J("entries",n.entries)("arrowCount",e.numberOfArrows)("disabled",e.locked)}}function J(s,r){if(1&s&&t._UZ(0,"app-entries-circles-list",13),2&s){const e=t.oxw(4);t.Q6J("entries",e.entries)}}function Y(s,r){if(1&s&&(t.ynx(0),t.YNc(1,Q,1,3,"app-entries-table",10),t.YNc(2,J,1,1,"app-entries-circles-list",11),t.BQk()),2&s){const e=r.ngIf;t.xp6(1),t.Q6J("ngIf","table"===e),t.xp6(1),t.Q6J("ngIf","circles"===e)}}function j(s,r){if(1&s&&(t.ynx(0),t.YNc(1,Y,3,2,"ng-container",0),t.ALo(2,"async"),t.BQk()),2&s){const e=t.oxw(2);t.xp6(1),t.Q6J("ngIf",t.lcZ(2,1,e.settingsRepo.entryListStyle$))}}function G(s,r){if(1&s&&t._UZ(0,"app-session-chart-stats",14),2&s){const e=t.oxw().ngIf;t.Q6J("session",e)}}function L(s,r){if(1&s){const e=t.EpF();t.ynx(0),t.TgZ(1,"div",1)(2,"div",2)(3,"h2"),t._uU(4),t.qZA(),t.TgZ(5,"h5",3)(6,"span"),t._uU(7),t.ALo(8,"dateDistance"),t.qZA(),t.TgZ(9,"span",4),t._uU(10,"\u2022"),t.qZA(),t.TgZ(11,"span"),t._uU(12),t.ALo(13,"date"),t.qZA()()(),t.TgZ(14,"app-session-options-menu",5),t.NdJ("sessionDeleted",function(){t.CHM(e);const o=t.oxw();return t.KtG(o.router.navigateByUrl("/list"))}),t.qZA()(),t._UZ(15,"mat-divider",6),t.YNc(16,U,1,1,"app-score-input",7),t.YNc(17,j,3,3,"ng-container",0),t.YNc(18,G,1,1,"app-session-chart-stats",8),t.BQk()}if(2&s){const e=r.ngIf,n=t.oxw();t.xp6(4),t.hij(" ",e.name," "),t.xp6(3),t.hij(" Created: ",t.lcZ(8,7,e.date_created)," "),t.xp6(5),t.hij(" ",t.xi3(13,9,e.date_created,"short")," "),t.xp6(2),t.Q6J("session",e),t.xp6(2),t.Q6J("ngIf",!e.locked),t.xp6(1),t.Q6J("ngIf",n.entries.length),t.xp6(1),t.Q6J("ngIf",n.entries.length>=2)}}let F=(()=>{class s{constructor(e,n,o,h,p){this.router=e,this.route=n,this.archerySessionRepo=o,this.snackbar=h,this.settingsRepo=p,this.destroy$=new C.x,this.entries=[]}ngOnInit(){this.route.params.pipe((0,f.R)(this.destroy$)).subscribe(e=>{const n=e.id;n?(this.archerySessionRepo.setActiveSession(n),this.archerySessionRepo.getActiveSession()||(this.snackbar.open("The session with that ID was not found","OK"),this.router.navigateByUrl("/list"))):this.router.navigateByUrl("/list")}),this.archerySessionRepo.activeSession$.pipe((0,f.R)(this.destroy$)).subscribe(e=>{this.entries=e?.entries?[...e.entries]:[]})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}onEntryEdit(e){const n=this.archerySessionRepo.getActiveSession();n&&n.id&&this.archerySessionRepo.editEntryForSession(n.id,e)}onDeleteEntry(e){const n=this.archerySessionRepo.getActiveSession();n&&n.id&&this.archerySessionRepo.deleteEntryForSession(n.id,e.id)}}return s.\u0275fac=function(e){return new(e||s)(t.Y36(_.F0),t.Y36(_.gz),t.Y36(D.H),t.Y36(w.ux),t.Y36(O.i))},s.\u0275cmp=t.Xpm({type:s,selectors:[["app-active-session-page"]],standalone:!0,features:[t.jDz],decls:2,vars:3,consts:[[4,"ngIf"],[1,"title-row"],[1,"flex-column"],[1,"flex-row","align-items-center"],[2,"margin","0 4px"],[3,"session","sessionDeleted"],[1,"margin-top-2x","margin-bottom-2x"],["class","margin-bottom-8x",3,"numberOfArrows","savedEntry",4,"ngIf"],[3,"session",4,"ngIf"],[1,"margin-bottom-8x",3,"numberOfArrows","savedEntry"],["class","margin-bottom-8x",3,"entries","arrowCount","disabled","entryEdited","deleteEntry",4,"ngIf"],["class","margin-bottom-8x",3,"entries",4,"ngIf"],[1,"margin-bottom-8x",3,"entries","arrowCount","disabled","entryEdited","deleteEntry"],[1,"margin-bottom-8x",3,"entries"],[3,"session"]],template:function(e,n){1&e&&(t.YNc(0,L,19,12,"ng-container",0),t.ALo(1,"async")),2&e&&t.Q6J("ngIf",t.lcZ(1,1,n.archerySessionRepo.activeSession$))},dependencies:[d.O5,d.Ov,_.Bz,d.uU,I.n,S.R,v.j,v.S,T.i,b,u.t,u.d],styles:["[_nghost-%COMP%]{display:block;padding:var(--spacing-3x) var(--spacing-1x)}@media (min-width: 768px){[_nghost-%COMP%]{padding:var(--spacing-3x)}}.title-row[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:var(--spacing-2x)}"],changeDetection:0}),s})()}}]);