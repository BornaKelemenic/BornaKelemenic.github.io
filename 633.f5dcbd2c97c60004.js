"use strict";(self.webpackChunkarchery_stats=self.webpackChunkarchery_stats||[]).push([[633],{633:(V,f,i)=>{i.r(f),i.d(f,{ActiveSessionPageComponent:()=>X});var l=i(6895),_=i(4850),m=i(9132),A=i(7579),v=i(2722),T=i(8735),E=i(5985),t=i(4650),h=i(4859),x=i(5412),g=(()=>((g||(g={})).DELETE="delete",g))(),a=(()=>{return(n=a||(a={})).GOLD="gold-scheme",n.RED="red-scheme",n.BLUE="blue-scheme",n.BLACK="black-scheme",n.WHITE="white-scheme",a;var n})(),C=i(6235);function P(n,o){if(1&n){const e=t.EpF();t.TgZ(0,"button",3),t.NdJ("click",function(){const c=t.CHM(e).$implicit,u=t.oxw(2);return t.KtG(u.action.emit(c.action))}),t.ALo(1,"async"),t._uU(2),t.qZA()}if(2&n){const e=o.$implicit,s=t.oxw(2);t.Tol(t.lcZ(1,3,s.settingsRepo.showColouredInputButton$)&&e.colorScheme||null),t.xp6(2),t.hij(" ",e.label," ")}}function Z(n,o){if(1&n&&(t.TgZ(0,"div",1),t.YNc(1,P,3,5,"button",2),t.qZA()),2&n){const e=t.oxw();t.xp6(1),t.Q6J("ngForOf",e.scoreInputConfig)}}const O=[{label:"0",action:0},{label:"10",action:10,colorScheme:a.GOLD},{label:"DEL",action:g.DELETE},{label:"7",action:7,colorScheme:a.RED},{label:"8",action:8,colorScheme:a.RED},{label:"9",action:9,colorScheme:a.GOLD},{label:"4",action:4,colorScheme:a.BLACK},{label:"5",action:5,colorScheme:a.BLUE},{label:"6",action:6,colorScheme:a.BLUE},{label:"1",action:1,colorScheme:a.WHITE},{label:"2",action:2,colorScheme:a.WHITE},{label:"3",action:3,colorScheme:a.BLACK}];let w=(()=>{class n{constructor(e){this.settingsRepo=e,this.scoreInputConfig=O,this.action=new t.vpe}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(C.i))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-score-input-buttons"]],inputs:{scoreInputConfig:"scoreInputConfig"},outputs:{action:"action"},standalone:!0,features:[t.jDz],decls:1,vars:1,consts:[["class","button-grid",4,"ngIf"],[1,"button-grid"],["mat-stroked-button","",3,"class","click",4,"ngFor","ngForOf"],["mat-stroked-button","",3,"click"]],template:function(e,s){1&e&&t.YNc(0,Z,2,1,"div",0),2&e&&t.Q6J("ngIf",s.scoreInputConfig)},dependencies:[l.ax,l.O5,l.Ov,h.ot,h.lW],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;align-items:center}.button-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,min-content);gap:var(--spacing-2x)}.button-grid[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:50px;height:50px;min-width:0}"],changeDetection:0}),n})();const R=["*"];let D=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-score-input-display-block"]],standalone:!0,features:[t.jDz],ngContentSelectors:R,decls:1,vars:0,template:function(e,s){1&e&&(t.F$t(),t.Hsn(0))},styles:["[_nghost-%COMP%]{display:inline-flex;align-items:center;justify-content:center;font-size:1.25em;padding:.25em;width:50px;height:50px}[_nghost-%COMP%]:not(.active){cursor:pointer}.active[_nghost-%COMP%]{box-shadow:0 2px 4px -1px #0003,0 4px 5px #00000024,0 1px 10px #0000001f}"],changeDetection:0}),n})();var y=i(4298),S=i(9613);function B(n,o){if(1&n){const e=t.EpF();t.ynx(0),t.TgZ(1,"app-score-input-display-block",4),t.NdJ("click",function(){const c=t.CHM(e).index,u=t.oxw();return t.KtG(u.activeShotIndex=c)}),t._uU(2),t.qZA(),t.BQk()}if(2&n){const e=o.$implicit,s=o.index,r=t.oxw();let c;t.xp6(1),t.ekj("active",s===r.activeShotIndex),t.xp6(1),t.hij(" ",null!==(c=null==e?null:e.value)&&void 0!==c?c:"-"," ")}}let F=(()=>{class n{set session(e){this.numberOfArrows=e.numberOfArrows}set numberOfArrows(e){this._numberOfArrows=e,this.resetShots()}get numberOfArrows(){return this._numberOfArrows}constructor(e){this.dialog=e,this._numberOfArrows=6,this.activeShotIndex=0,this.shots=[],this.savedEntry=new t.vpe}resetShots(){this.shots=new Array(this.numberOfArrows).fill(null),this.activeShotIndex=0}saveEntryToRepo(e){this.savedEntry.emit((0,y.Yo)({shots:e})),this.resetShots()}buttonInputAction(e){"number"==typeof e?(this.shots[this.activeShotIndex]=(0,y.Ey)({value:e}),this.activeShotIndex=++this.activeShotIndex%this.shots.length):this.shots[this.activeShotIndex]=null}save(){const e=this.shots.filter(s=>!!s).sort((s,r)=>r.value-s.value);e.length?e.length<this.numberOfArrows?this.dialog.open(S.M,{restoreFocus:!1,autoFocus:!1,width:"500px",data:{title:"Some of the shots have no value",text:"Are you sure you want to add an entry without all shots having a value?"}}).afterClosed().subscribe(r=>{r&&this.saveEntryToRepo(e)}):this.saveEntryToRepo(e):this.dialog.open(S.M,{restoreFocus:!1,autoFocus:!1,width:"500px",data:{title:"Are you sure you want to add an entry with no shots ?"}}).afterClosed().subscribe(r=>{r&&this.saveEntryToRepo(e)})}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(x.uw))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-score-input"]],inputs:{session:"session"},outputs:{savedEntry:"savedEntry"},standalone:!0,features:[t.jDz],decls:5,vars:1,consts:[[1,"blocks-grid","margin-bottom-4x"],[4,"ngFor","ngForOf"],[3,"action"],["mat-raised-button","","color","primary",1,"margin-top-4x",3,"click"],[3,"click"]],template:function(e,s){1&e&&(t.TgZ(0,"div",0),t.YNc(1,B,3,3,"ng-container",1),t.qZA(),t.TgZ(2,"app-score-input-buttons",2),t.NdJ("action",function(c){return s.buttonInputAction(c)}),t.qZA(),t.TgZ(3,"button",3),t.NdJ("click",function(){return s.save()}),t._uU(4," Save\n"),t.qZA()),2&e&&(t.xp6(1),t.Q6J("ngForOf",s.shots))},dependencies:[l.ax,D,w,h.ot,h.lW,x.Is],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;align-items:center}.blocks-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,min-content);gap:var(--spacing-2x)}"],changeDetection:0}),n})();var p=i(6858),L=i(1282),d=i(848),b=i(5621),I=i(6276);const U=["scorePerShotChartRef"],J=["averagePerEntryChartRef"];p.kL.register(p.ST,p.uw,p.f$,p.od,p.jn,L.Z,p.Gu,p.u);let Q=(()=>{class n{set session(e){this._session=e,this.scorePerShotChart&&this.setChartOptions()}get session(){return this._session}ngAfterViewInit(){p.kL.defaults.color=b.I.foregroundText(),p.kL.defaults.borderColor=b.I.getProp("--foreground-divider"),this.scorePerShotChart=new p.kL(this.scorePerShotChartRef.nativeElement,{type:"line",data:{datasets:[]}}),this.averagePerEntryChart=new p.kL(this.averagePerEntryChartRef.nativeElement,{type:"line",data:{datasets:[]}}),this.setChartOptions()}setChartOptions(){this.scorePerShotChart.data={labels:this.session.entries.map((e,s)=>s+1),datasets:[{...d.EC,data:this.session.entries.map(e=>(0,I.Iz)(e.shots.map(s=>s.value)))}]},this.scorePerShotChart.options={...(0,d.lR)(10*this.session.numberOfArrows)},this.scorePerShotChart.update("none"),this.averagePerEntryChart.data={labels:this.session.entries.map((e,s)=>s+1),datasets:[{...d.EC,data:this.session.entries.map(e=>+(0,I.Y8)(e.shots.map(s=>s.value)).toFixed(2))}]},this.averagePerEntryChart.options={...(0,d.lR)(12)},this.averagePerEntryChart.update("none")}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-session-chart-stats"]],viewQuery:function(e,s){if(1&e&&(t.Gf(U,5),t.Gf(J,5)),2&e){let r;t.iGM(r=t.CRH())&&(s.scorePerShotChartRef=r.first),t.iGM(r=t.CRH())&&(s.averagePerEntryChartRef=r.first)}},inputs:{session:"session"},standalone:!0,features:[t.jDz],decls:10,vars:1,consts:[[1,"chart-holder"],["scorePerShotChartRef",""],["averagePerEntryChartRef",""]],template:function(e,s){1&e&&(t.TgZ(0,"h2"),t._uU(1),t.qZA(),t.TgZ(2,"div",0),t._UZ(3,"canvas",null,1),t.qZA(),t.TgZ(5,"h2"),t._uU(6,"Average per entry"),t.qZA(),t.TgZ(7,"div",0),t._UZ(8,"canvas",null,2),t.qZA()),2&e&&(t.xp6(1),t.hij("Score per ",s.session.numberOfArrows," shots"))},changeDetection:0}),n})();var M=i(84),k=i(5270),Y=i(7697),j=i(7009);function N(n,o){if(1&n){const e=t.EpF();t.TgZ(0,"app-score-input",9),t.NdJ("savedEntry",function(r){t.CHM(e);const c=t.oxw(2);return t.KtG(c.archerySessionRepo.addEntryForActiveSession(r))}),t.qZA()}if(2&n){const e=t.oxw().ngIf;t.Q6J("session",e)}}function $(n,o){if(1&n&&t._UZ(0,"app-entries-table",11),2&n){const e=t.oxw(4);t.Q6J("entries",e.entries)}}function G(n,o){if(1&n&&t._UZ(0,"app-entries-circles-list",11),2&n){const e=t.oxw(4);t.Q6J("entries",e.entries)}}function H(n,o){if(1&n&&(t.ynx(0),t.YNc(1,$,1,1,"app-entries-table",10),t.YNc(2,G,1,1,"app-entries-circles-list",10),t.BQk()),2&n){const e=o.ngIf;t.xp6(1),t.Q6J("ngIf","table"===e),t.xp6(1),t.Q6J("ngIf","circles"===e)}}function z(n,o){if(1&n&&(t.ynx(0),t.YNc(1,H,3,2,"ng-container",0),t.ALo(2,"async"),t.BQk()),2&n){const e=t.oxw(2);t.xp6(1),t.Q6J("ngIf",t.lcZ(2,1,e.settingsRepo.entryListStyle$))}}function K(n,o){if(1&n&&t._UZ(0,"app-session-chart-stats",12),2&n){const e=t.oxw().ngIf;t.Q6J("session",e)}}function W(n,o){if(1&n){const e=t.EpF();t.ynx(0),t.TgZ(1,"div",1)(2,"div",2)(3,"h2"),t._uU(4),t.qZA(),t.TgZ(5,"h5",3)(6,"span"),t._uU(7),t.ALo(8,"dateDistance"),t.qZA(),t.TgZ(9,"span",4),t._uU(10,"\u2022"),t.qZA(),t.TgZ(11,"span"),t._uU(12),t.ALo(13,"date"),t.qZA()()(),t.TgZ(14,"app-session-options-menu",5),t.NdJ("sessionDeleted",function(){t.CHM(e);const r=t.oxw();return t.KtG(r.router.navigateByUrl("/list"))}),t.qZA()(),t._UZ(15,"mat-divider",6),t.YNc(16,N,1,1,"app-score-input",7),t.YNc(17,z,3,3,"ng-container",0),t.YNc(18,K,1,1,"app-session-chart-stats",8),t.BQk()}if(2&n){const e=o.ngIf,s=t.oxw();t.xp6(4),t.hij(" ",e.name," "),t.xp6(3),t.hij(" Created: ",t.lcZ(8,7,e.date_created)," "),t.xp6(5),t.hij(" ",t.xi3(13,9,e.date_created,"short")," "),t.xp6(2),t.Q6J("session",e),t.xp6(2),t.Q6J("ngIf",!e.locked),t.xp6(1),t.Q6J("ngIf",s.entries.length),t.xp6(1),t.Q6J("ngIf",s.entries.length>=2)}}let X=(()=>{class n{constructor(e,s,r,c,u){this.router=e,this.route=s,this.archerySessionRepo=r,this.snackbar=c,this.settingsRepo=u,this.destroy$=new A.x,this.entries=[]}ngOnInit(){this.route.params.pipe((0,v.R)(this.destroy$)).subscribe(e=>{const s=e.id;s?(this.archerySessionRepo.setActiveSession(s),this.archerySessionRepo.getActiveSession()||(this.snackbar.open("The session with that ID was not found","OK"),this.router.navigateByUrl("/list"))):this.router.navigateByUrl("/list")}),this.archerySessionRepo.activeSession$.pipe((0,v.R)(this.destroy$)).subscribe(e=>{this.entries=e?.entries?[...e.entries]:[]})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(m.F0),t.Y36(m.gz),t.Y36(Y.H),t.Y36(j.ux),t.Y36(C.i))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-active-session-page"]],standalone:!0,features:[t.jDz],decls:2,vars:3,consts:[[4,"ngIf"],[1,"title-row"],[1,"flex-column"],[1,"flex-row","align-items-center"],[2,"margin","0 4px"],[3,"session","sessionDeleted"],[1,"margin-top-2x","margin-bottom-2x"],["class","margin-bottom-8x",3,"session","savedEntry",4,"ngIf"],[3,"session",4,"ngIf"],[1,"margin-bottom-8x",3,"session","savedEntry"],["class","margin-bottom-8x",3,"entries",4,"ngIf"],[1,"margin-bottom-8x",3,"entries"],[3,"session"]],template:function(e,s){1&e&&(t.YNc(0,W,19,12,"ng-container",0),t.ALo(1,"async")),2&e&&t.Q6J("ngIf",t.lcZ(1,1,s.archerySessionRepo.activeSession$))},dependencies:[l.O5,l.Ov,m.Bz,l.uU,k.n,F,T.j,E.S,M.i,Q,_.t,_.d],styles:["[_nghost-%COMP%]{display:block;padding:var(--spacing-3x) var(--spacing-1x)}@media (min-width: 768px){[_nghost-%COMP%]{padding:var(--spacing-3x)}}.title-row[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:var(--spacing-2x)}"],changeDetection:0}),n})()}}]);